# KanVM документация

###Команды
Команды определены в файле kan/executor/bytecode_def.h, здесь же будет описание каждой из них

- PLUSB, MINUSB, MULB, DIVB, POWB(unimplemented)
        
        Берут 2 значения из стека и соответственно 
        складывают/вычитают/умнодают/делят/возводят в степень
        результат будет положен в стек

- UMINUS, UPLUS

        Берут 1 значение из стека и соответственно применяют к ним
        унарный плюс или унарный минус

- GET_ATTRIBUTEB

        Берет из стека объект, у которого берет аттрибут и кладет его в стек
        
         аргмуенты:
            1. string_size: uint16_t - длина строки(максимальная длина строки: 2^16)
            2. строка
  
- CALLB
 
        Вызывает последний объект в стеке, результат вызова кладет туда же(в стек)
        
        аргументы:
            1. argscount: uint32_t - кол-во аргументов в вызове
        
        аргументы для вызова берутся из стека и передаются в обратном порядке

- PUSH_INTEGRAL


        Кладет в стек 32битный целочисленный тип
        TODO: добавить float
        
        аргументы:
            1. size: uint16_t - сейчас всегда равен 4
            2. number: int - число, которое кладется в стек(пока только 32бит integer)

- PUSH_STRING

    
        Кладет в стек строку
        
        аргументы:
            1. string_size: uint16_t - размер строки
            2. string - сама строка
        
- LOAD_ID

        Ищет в текущей области видимости имя и кладет его в стек
        
        аргументы:
            1. name_size: uint16_t - размер имени
            2. name - само имя 

- SET_NAME

        Берет 1 объект из скоупа и присваивает ему в нем имя
        
        аргументы:
            1. name_size: uint16_t - размер имени
            2. name - само имя
        
- START_SCOPE

        Добавляет 1 скоуп к очереди из них
        
        если этот скоуп первый созданный, то определяет его как глобальный

- END_SCOPE

        Берет последний скоуп из очереди и:
            1. Уменьшает кол-во ссылок в каждом объекте, который находится в скоупе на 1
               если кол-во ссылок <= 1, то память под объект освобождается
            2. Скоуп удаляется из очереди
            3. Память, занятая скоупом очищается
        
- JMP_TO_ADDRESS

        Прыгает на адрес
        
        аргументы:
            1. address: uint64_t - адрес
    
- JMP_IF_TRUE

        Прыгает на count адресов вперед, если последний объект из очереди истинный
        
        *Объект из очереди не удаляется
        
        аргументы:
            1. count: uint64_t - сдвиг

- JMP_IF_FALSE


        Делает то же самое, но если объект из очереди будет не истинным

- JMP_NEXT

    
        Прыгает на count адресов вперед
        
        аргументы:
            1. count: uint64_t - сдвиг
        
- JMP_BACK


        делает то же самое, что и JMP_NEXT, но прыгает на count адресов назад

- POP_OBJECT


        удаляет последний объект из очереди
